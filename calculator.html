<!DOCTYPE html>
<html lang="pt-BR" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora com Seletor de Cores</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class', // Habilita o modo escuro baseado em classe
            theme: {
                extend: {
                    colors: {
                        // Cores personalizadas se necessário
                    }
                }
            }
        }
    </script>
    <style>
        /* Estilos adicionais se necessário */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #e5e7eb; /* light gray background */
        }
        .dark body {
            background-color: #1f2937; /* dark gray background for dark mode */
        }
        .calculator {
            width: clamp(280px, 90vmin, 400px); /* Responsividade do tamanho da calculadora */
            height: auto;
        }
        /* Ajustes para o input de cor */
        #colorPicker {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-color: transparent;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 0; /* Remove padding interno para melhor visualização da cor */
        }
        #colorPicker::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        #colorPicker::-webkit-color-swatch {
            border: none;
            border-radius: 4px; /* Arredonda o swatch interno */
        }
        #colorPicker::-moz-color-swatch {
            border: none;
            border-radius: 4px;
        }
    </style>
</head>

<body>

    <div class="calculator bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-slate-200 dark:border-slate-700
                w-full h-full font-mono flex flex-col p-[1.5vmin]">

        <!-- Seletor de Cores -->
        <div class="color-picker-container flex items-center mb-[1.5vmin] justify-between">
            <label for="colorPicker" class="text-[1.8vmin] mr-[1vmin] text-slate-700 dark:text-slate-300">Cor do Tema:</label>
            <input type="color" id="colorPicker" value="#64748b" class="w-[6vmin] h-[3.5vmin] cursor-pointer">
        </div>

        <!-- Visor da Calculadora -->
        <input type="text" id="screen" readonly
            class="screen bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-slate-100
                   text-right text-[5vmin] p-[2vmin] mb-[1.5vmin] rounded-md w-full
                   focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400
                   border border-slate-300 dark:border-slate-600">

        <!-- Botões da Calculadora -->
        <div class="buttons grid grid-cols-4 gap-[1vmin] flex-grow">
            <!-- Linha 1 -->
            <button onclick="clearScreen()" class="button btn-op text-[2.5vmin] p-[2vmin] bg-slate-300 dark:bg-slate-600 hover:bg-slate-400 dark:hover:bg-slate-500 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">AC</button>
            <button onclick="toggleSign()" class="button btn-op text-[2.5vmin] p-[2vmin] bg-slate-300 dark:bg-slate-600 hover:bg-slate-400 dark:hover:bg-slate-500 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">+/-</button>
            <button onclick="inputOperator('%')" class="button btn-op text-[2.5vmin] p-[2vmin] bg-slate-300 dark:bg-slate-600 hover:bg-slate-400 dark:hover:bg-slate-500 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">%</button>
            <button onclick="inputOperator('/')" class="button btn-op text-[2.5vmin] p-[2vmin] bg-slate-300 dark:bg-slate-600 hover:bg-slate-400 dark:hover:bg-slate-500 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">÷</button>

            <!-- Linha 2 -->
            <button onclick="inputDigit('7')" class="button btn-num text-[2.5vmin] p-[2vmin] bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">7</button>
            <button onclick="inputDigit('8')" class="button btn-num text-[2.5vmin] p-[2vmin] bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">8</button>
            <button onclick="inputDigit('9')" class="button btn-num text-[2.5vmin] p-[2vmin] bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">9</button>
            <button onclick="inputOperator('*')" class="button btn-op text-[2.5vmin] p-[2vmin] bg-slate-300 dark:bg-slate-600 hover:bg-slate-400 dark:hover:bg-slate-500 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">×</button>

            <!-- Linha 3 -->
            <button onclick="inputDigit('4')" class="button btn-num text-[2.5vmin] p-[2vmin] bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">4</button>
            <button onclick="inputDigit('5')" class="button btn-num text-[2.5vmin] p-[2vmin] bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">5</button>
            <button onclick="inputDigit('6')" class="button btn-num text-[2.5vmin] p-[2vmin] bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">6</button>
            <button onclick="inputOperator('-')" class="button btn-op text-[2.5vmin] p-[2vmin] bg-slate-300 dark:bg-slate-600 hover:bg-slate-400 dark:hover:bg-slate-500 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">-</button>

            <!-- Linha 4 -->
            <button onclick="inputDigit('1')" class="button btn-num text-[2.5vmin] p-[2vmin] bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">1</button>
            <button onclick="inputDigit('2')" class="button btn-num text-[2.5vmin] p-[2vmin] bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">2</button>
            <button onclick="inputDigit('3')" class="button btn-num text-[2.5vmin] p-[2vmin] bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">3</button>
            <button onclick="inputOperator('+')" class="button btn-op text-[2.5vmin] p-[2vmin] bg-slate-300 dark:bg-slate-600 hover:bg-slate-400 dark:hover:bg-slate-500 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">+</button>

            <!-- Linha 5 -->
            <button onclick="inputDigit('0')" class="button btn-num text-[2.5vmin] p-[2vmin] bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-800 dark:text-slate-200 rounded-md col-span-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">0</button>
            <button onclick="inputDecimal()" class="button btn-num text-[2.5vmin] p-[2vmin] bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-800 dark:text-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">.</button>
            <button onclick="calculate()" class="button btn-equals text-[2.5vmin] p-[2vmin] bg-slate-500 dark:bg-slate-500 hover:bg-slate-600 dark:hover:bg-slate-400 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400 transition-colors">=</button>
        </div>

        <!-- Botão Dark Mode -->
        <button id="darkModeToggle" class="mt-[1.5vmin] p-[1vmin] text-[1.8vmin] bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-md hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors w-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 dark:focus:ring-slate-400">
            Modo Escuro/Claro
        </button>
    </div>

    <script>
        const screen = document.getElementById('screen');
        let currentInput = '0';
        let operator = null;
        let previousInput = null;
        let waitingForSecondOperand = false;

        function updateScreen() {
            screen.value = currentInput;
        }

        function inputDigit(digit) {
            if (waitingForSecondOperand) {
                currentInput = digit;
                waitingForSecondOperand = false;
            } else {
                currentInput = currentInput === '0' ? digit : currentInput + digit;
            }
            updateScreen();
        }

        function inputDecimal() {
            if (waitingForSecondOperand) {
                currentInput = '0.';
                waitingForSecondOperand = false;
                updateScreen();
                return;
            }
            if (!currentInput.includes('.')) {
                currentInput += '.';
            }
            updateScreen();
        }

        function clearScreen() {
            currentInput = '0';
            operator = null;
            previousInput = null;
            waitingForSecondOperand = false;
            updateScreen();
        }

        function inputOperator(nextOperator) {
            const inputValue = parseFloat(currentInput);

            if (operator && waitingForSecondOperand) {
                operator = nextOperator;
                return;
            }

            if (previousInput === null) {
                previousInput = inputValue;
            } else if (operator) {
                const result = performCalculation[operator](previousInput, inputValue);
                currentInput = String(parseFloat(result.toFixed(7))); // Limita casas decimais
                previousInput = result;
            }

            waitingForSecondOperand = true;
            operator = nextOperator;
            updateScreen();
        }
        
        const performCalculation = {
            '/': (firstOperand, secondOperand) => secondOperand === 0 ? 'Erro' : firstOperand / secondOperand,
            '*': (firstOperand, secondOperand) => firstOperand * secondOperand,
            '+': (firstOperand, secondOperand) => firstOperand + secondOperand,
            '-': (firstOperand, secondOperand) => firstOperand - secondOperand,
            '%': (firstOperand, secondOperand) => firstOperand * (secondOperand / 100) // Cálculo de porcentagem
        };

        function calculate() {
            if (operator === null || waitingForSecondOperand) {
                return;
            }
            const inputValue = parseFloat(currentInput);
            if (operator === '/' && inputValue === 0) {
                 currentInput = 'Erro';
                 updateScreen();
                 operator = null;
                 previousInput = null;
                 waitingForSecondOperand = false;
                 return;
            }
            const result = performCalculation[operator](previousInput, inputValue);
            
            currentInput = String(parseFloat(result.toFixed(7))); // Limita casas decimais
            operator = null;
            previousInput = null;
            waitingForSecondOperand = false;
            updateScreen();
        }

        function toggleSign() {
            currentInput = String(parseFloat(currentInput) * -1);
            updateScreen();
        }
        
        // Inicializa o visor
        updateScreen();

        // Dark Mode Toggle
        const darkModeToggle = document.getElementById('darkModeToggle');
        const htmlElement = document.documentElement;

        // Verifica preferência do sistema ou localStorage
        if (localStorage.getItem('darkMode') === 'true' || 
            (!('darkMode' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            htmlElement.classList.add('dark');
        } else {
            htmlElement.classList.remove('dark');
        }

        darkModeToggle.addEventListener('click', () => {
            htmlElement.classList.toggle('dark');
            // Salva a preferência do usuário
            if (htmlElement.classList.contains('dark')) {
                localStorage.setItem('darkMode', 'true');
            } else {
                localStorage.setItem('darkMode', 'false');
            }
        });

        // --- INÍCIO: LÓGICA DO SELETOR DE CORES ---
        const colorPicker = document.getElementById("colorPicker");
        const calculatorElement = document.querySelector(".calculator"); // Referência ao elemento da calculadora se precisar
        const styleTagId = "custom-theme-styles"; // ID para a tag de estilo dinâmica

        // Função para aplicar a cor do tema
        function applyThemeColor(color) {
            // Criar versões mais claras e escuras da cor selecionada
            const lighterColor = adjustColorBrightness(color, 40); // Mais claro para botões de operação
            const darkerColor = adjustColorBrightness(color, -20);  // Mais escuro para bordas

            // Aplicar às classes dos botões
            // Botão de Igual (cor principal)
            document.querySelectorAll(".btn-equals").forEach(btn => {
                btn.style.backgroundColor = color;
                btn.style.borderColor = darkerColor;
                // Para manter o contraste do texto, podemos decidir a cor do texto baseado no brilho da cor de fundo
                btn.style.color = getContrastYIQ(color);
            });
            
            // Botões de Operação (cor mais clara)
            document.querySelectorAll(".btn-op").forEach(btn => {
                btn.style.backgroundColor = lighterColor;
                btn.style.borderColor = color;
                btn.style.color = getContrastYIQ(lighterColor);
            });
            
            // Aplicar ao foco dos elementos (usando variável CSS)
            document.documentElement.style.setProperty('--theme-color-focus', color);

            // Adicionar/atualizar estilos para o foco dinamicamente
            let styleTag = document.getElementById(styleTagId);
            if (!styleTag) {
                styleTag = document.createElement('style');
                styleTag.id = styleTagId;
                document.head.appendChild(styleTag);
            }
            // Usamos !important com cautela, apenas se necessário para sobrescrever Tailwind
            styleTag.innerHTML = `
                .button:focus {
                    --tw-ring-color: ${color} !important; 
                }
                #screen:focus {
                    --tw-ring-color: ${color} !important;
                }
                #darkModeToggle:focus {
                     --tw-ring-color: ${color} !important;
                }
            `;
        }

        // Função auxiliar para ajustar o brilho de uma cor hexadecimal
        function adjustColorBrightness(hex, percent) {
            hex = hex.replace(/^#/, '');
            if (hex.length === 3) {
                hex = hex.split('').map(char => char + char).join('');
            }

            let r = parseInt(hex.substring(0, 2), 16);
            let g = parseInt(hex.substring(2, 4), 16);
            let b = parseInt(hex.substring(4, 6), 16);

            r = Math.max(0, Math.min(255, Math.round(r * (1 + percent / 100))));
            g = Math.max(0, Math.min(255, Math.round(g * (1 + percent / 100))));
            b = Math.max(0, Math.min(255, Math.round(b * (1 + percent / 100))));
            
            const toHex = c => ('0' + c.toString(16)).slice(-2);
            return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
        }
        
        // Função para obter cor de texto contrastante (branco ou preto)
        function getContrastYIQ(hexcolor){
            hexcolor = hexcolor.replace("#", "");
            var r = parseInt(hexcolor.substr(0,2),16);
            var g = parseInt(hexcolor.substr(2,2),16);
            var b = parseInt(hexcolor.substr(4,2),16);
            var yiq = ((r*299)+(g*587)+(b*114))/1000;
            return (yiq >= 128) ? '#000000' : '#FFFFFF';
        }


        // Verificar se há uma cor salva no localStorage ao carregar a página
        document.addEventListener("DOMContentLoaded", function() {
            const savedColor = localStorage.getItem("calculatorThemeColor");
            const defaultColor = "#64748b"; // Cor padrão se nada estiver salvo

            if (savedColor) {
                colorPicker.value = savedColor;
                applyThemeColor(savedColor);
            } else {
                colorPicker.value = defaultColor; // Define o valor do picker para o padrão
                applyThemeColor(defaultColor); // Aplica a cor padrão inicialmente
            }
        });

        // Aplicar a cor enquanto o usuário seleciona (live update)
        colorPicker.addEventListener("input", function(event) {
            const selectedColor = event.target.value;
            applyThemeColor(selectedColor);
        });

        // Salvar a cor quando o usuário finalizar a seleção (soltar o mouse ou fechar o picker)
        colorPicker.addEventListener("change", function(event) {
            const selectedColor = event.target.value;
            localStorage.setItem("calculatorThemeColor", selectedColor);
        });
        // --- FIM: LÓGICA DO SELETOR DE CORES ---

    </script>
</body>
</html>
